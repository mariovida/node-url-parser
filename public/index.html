<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <link rel="stylesheet" type="text/css" href="style.css" />
    <title>URL Parser</title>
  </head>
  <body>
    <div class="wrapper">
      <div class="box">
        <h1>Upload a TXT file for URL parsing</h1>
        <p>
          The application parses URLs to extract information such as page titles
          and email addresses.
        </p>
        <form id="uploadForm">
          <input type="file" name="file" accept=".txt" required />
          <button type="submit">Upload</button>
        </form>
      </div>
      <h2>RESULTS</h2>
      <button id="copyButton">Copy results</button>
      <div id="loadingIndicator">Processing...</div>
      <pre id="results"></pre>
    </div>

    <script>
      document.getElementById("uploadForm").onsubmit = async (event) => {
        event.preventDefault();
        const formData = new FormData(event.target);
        document.getElementById("loadingIndicator").style.display = "block";

        try {
          const response = await fetch("/upload", {
            method: "POST",
            body: formData,
          });

          if (!response.ok) {
            throw new Error("Network response was not ok");
          }

          const results = await response.json();
          document.getElementById("results").textContent = JSON.stringify(
            results,
            null,
            2
          );

          document.getElementById("copyButton").style.display = "block";
        } catch (error) {
          document.getElementById(
            "results"
          ).textContent = `Error: ${error.message}`;
          document.getElementById("copyButton").style.display = "none";
        } finally {
          document.getElementById("loadingIndicator").style.display = "none";
        }
      };

      /* Function to copy results to clipboard */
      document.getElementById("copyButton").onclick = () => {
        const resultsText = document.getElementById("results").textContent;

        if (resultsText) {
          navigator.clipboard
            .writeText(resultsText)
            .then(() => {
              alert("Results copied to clipboard!");
            })
            .catch((err) => {
              console.error("Failed to copy: ", err);
            });
        }
      };
    </script>
  </body>
</html>
